# APOiBAS_Lab3_WEBAPI
Лабораторная работа №3 по предмету "Архитектура, программное обеспечение и безопасность автоматизированных систем"

# Задание 3. Комбинированное

Чешский национальный банк предоставляет возможность отслеживать валютный курс чешской кроны.

Ежедневный курс доступен по адресу: https://www.cnb.cz/en/financial_markets/foreign_exchange_market/exchange_rate_fixing/daily.txt?date=27.07.2019

Исторические данные доступны по адресу: https://www.cnb.cz/en/financial_markets/foreign_exchange_market/exchange_rate_fixing/year.txt?year=2019

### Задание

Необходимо разработать программное решение, обладающее следующей функциональностью:

1. Cинхронизация данных по чешской кроне за текущую дату в БД по расписанию. Должна быть возможность сконфигурировать время/интервал запуска. Например: запускать синхронизацию каждый день в 0:01. Период запуска должен задаваться конфигурации приложения.
2. Cинхронизация данных по чешской кроне за период времени. На вход подается startDate и endDate, приложение синхронизирует в БД данные за этот период. Валюты, по которым синхронизируются данные, должны быть в конфигурации приложения.
3. Gредоставляет web-API, с помощью которого можно получить отчет по курсу кроны за период времени. В отчете необходимо вывести минимальное, максимальное и среднее значение каждой из выбранных валют отдельно. Валюты, по которым строится отчёт, передаются в запросе. Показатели в отчёте необходимо рассчитывать для валюты в количестве 1 условная единица, т.е. для Amount = 1. Формат отчета – JSON
4. Было бы неплохо иметь тесты, хотя бы на базовые сценарии формирования отчета.

Необходимо учесть, что в данных, предоставляемых API, могут быть аномалии. Например, для некоторых временных интервалов может не быть курсов определенных валют и т.п.


## Результат

Разработан асинхронный WEB-API на базе quart-приложения.

### Отчет по курсу кроны за период времени:
 - url: `http://{IP}:{PORT}/exchanges/[?startDate=YYYY-MM-DD[&endDate=YYYY-MM-DD[$currencies={code1[,code2[,...]]}]]]`
    > Формат указания валют - `code1[,code2[, ...]]`
    
    > Например: `http://127.0.0.1:5000/exchanges/?startDate=2022-08-25&endDate=2023-12-31&currencies=rub,usd`
 - Формат ответа: `{[{cur}:{"avg":"{val}", "max": {val}, "min": {val}}[, ...]]}`
    > Например: `{"rub":{"avg":"0.022469","max":"0.023360","min":"0.021670"},"usd":{"avg":"24.606855","max":"32.682000","min":"21.110000"}}`
 
### Синхронизация курса кроны за период времени:
 - url: `http://{IP}:{PORT}/exchanges/sync/[?startDate=YYYY-MM-DD[&endDate=YYYY-MM-DD]]`
    > Например: `http://127.0.0.1:5000/exchanges/sync/?startDate=2020-08-25&endDate=2022-12-31`
 - Формат ответа: `"Synchronization of {count} records completed successfully!"`
    > Например: `"Synchronization of 755 records completed successfully!"`
 
> ##### Наложены следующие огораничения на задваемые даты:
>> Формат указания даты - `YYYY-MM-DD`
> 
>> startDate <= endDate <= today (не больше текущей даты)
> 
> В противном случае результаты запросов будут выглядеть следующим образом:
> 
> `"Incorrect dates entered"`

### Синхронизация курса кроны c заданной периодичностью:
#### Конфигурационная информация указывается в файле ```config.py```.
- Периодичность синхронизации задается в cron-формате в переменной `UPDATE_PERIOD`:\
  `'<Минуты> <Часы> <Дни_месяца> <Месяцы> <Дни_недели>'`
   > Например: \
   > `UPDATE_PERIOD = '* * * * *'` - каждую минуту;\
   > `UPDATE_PERIOD = '0 * * * *'` - в `0 минут` каждого часа;\
   > `UPDATE_PERIOD = '15,45 12,20 * * *'` - каждый день в `12:15`, `12:45`, `20:15`, `20:45`\
   > `UPDATE_PERIOD = '0 9 * 6,12 4'` - каждую `пятницу` в `июне` и `декабре` в `9:00`
- Отслеживаемые валюты задаются множеством строковых представлений кодировок валют прописными символами латинского алфавита в переменной `CURRENCIES`\
   `{[code1[,code2[, ...]]]}`
   > Например: `CURRENCIES = {'rub', 'eur', 'usd', 'jpy'}`
  
### Для тестирования программы реализован файл `tests.py`